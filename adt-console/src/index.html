<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ADT Operator Console</title>
  <link rel="stylesheet" href="css/console.css">
  <link rel="stylesheet" href="vendor/xterm.css">
</head>
<body>
  <!-- Top Bar -->
  <header id="topbar">
    <div class="topbar-brand">
      <span class="brand-logo">ADT</span>
      <span class="brand-title">Operator Console</span>
    </div>
    <div id="session-tabs" class="topbar-tabs">
      <!-- Session tabs injected by JS -->
    </div>
    <div class="topbar-actions">
      <button id="btn-new-session" title="New Session (Ctrl+N)">+</button>
      <button id="btn-split" title="Split View (Ctrl+\)">&#9707;</button>
      <button id="btn-dashboard" title="Dashboard (Ctrl+D)">&#9638;</button>
      <button id="btn-governance" title="Governance (Ctrl+G)">&#9881;</button>
      <button id="btn-adt-panel" title="ADT Panel (Ctrl+P)">&#9670;</button>
      <button id="btn-shortcuts" title="Keyboard Shortcuts (?)">?</button>
    </div>
  </header>

  <!-- Main Layout -->
  <div id="main">
    <!-- Left Sidebar: Session List -->
    <aside id="sidebar-left" class="sidebar">
      <div class="sidebar-header">
        <span>Sessions</span>
        <button class="sidebar-collapse-btn" id="btn-collapse-left" title="Collapse (Ctrl+B)">&lsaquo;</button>
      </div>
      <ul id="session-list">
        <!-- Session entries injected by JS -->
      </ul>
      <div class="sidebar-footer">
        <button id="btn-new-session-sidebar" class="sidebar-action-btn">+ New Session</button>
      </div>
    </aside>

    <!-- Center: Terminal Area -->
    <main id="terminal-area">
      <div id="terminal-container">
        <!-- xterm.js instances injected here -->
      </div>
      <!-- Dashboard View -->
      <div id="dashboard-view" class="dashboard-view" style="display:none">
        <div class="dashboard-header">
          <h2>Session Dashboard</h2>
          <div id="dashboard-stats" class="dashboard-stats"></div>
        </div>
        <div id="dashboard-grid" class="dashboard-grid"></div>
      </div>

      <!-- Governance Panel (SPEC-003/013) -->
      <div id="governance-view" class="governance-view" style="display:none">
        <div class="gov-header">
          <div class="gov-tabs">
            <button class="gov-tab-btn active" data-tab="taskboard" onclick="GovernancePanel.switchTab('taskboard')">Task Board</button>
            <button class="gov-tab-btn" data-tab="hierarchy" onclick="GovernancePanel.switchTab('hierarchy')">Hierarchy</button>
            <button class="gov-tab-btn" data-tab="delegation" onclick="GovernancePanel.switchTab('delegation')">Delegation</button>
          </div>
          <button class="gov-refresh-btn" onclick="GovernancePanel.refresh()" title="Refresh data">&#8635;</button>
        </div>
        <div id="gov-content" class="gov-content"></div>
      </div>

      <!-- ADT Panel Embedded (SPEC-021) -->
      <div id="adt-panel-view" class="adt-panel-view" style="display:none">
        <iframe id="adt-panel-iframe" src="about:blank"></iframe>
      </div>

      <div id="empty-state" class="empty-state">
        <div class="empty-logo">ADT</div>
        <p>No active sessions</p>
        <p class="hint">Press <kbd>Ctrl+N</kbd> to create a new session</p>
        <p class="hint">Press <kbd>?</kbd> for all keyboard shortcuts</p>
      </div>
    </main>

    <!-- Right Sidebar: Context Panel -->
    <aside id="sidebar-right" class="sidebar">
      <div class="sidebar-header">
        <span>Hive Tracker</span>
        <div id="ctx-remote-status" class="status-dot dot-grey" title="ADT Center Connection"></div>
        <button class="sidebar-collapse-btn" id="btn-collapse-right" title="Collapse (Ctrl+I)">&rsaquo;</button>
      </div>
      <div id="context-panel">
        <section class="context-section">
          <h3>Active Session</h3>
          <div class="session-info-grid" style="font-size: 0.75rem; display: grid; grid-template-columns: 1fr 1fr; gap: 4px;">
            <div><strong style="color:var(--text-muted)">Role:</strong> <span id="ctx-role">—</span></div>
            <div><strong style="color:var(--text-muted)">Agent:</strong> <span id="ctx-agent">—</span></div>
            <div><strong style="color:var(--text-muted)">Spec:</strong> <span id="ctx-spec" class="ctx-truncate">—</span></div>
            <div><strong style="color:var(--text-muted)">Time:</strong> <span id="ctx-uptime">—</span></div>
          </div>
          
          <div id="ctx-task-container" style="margin-top: 8px; border-top: 1px solid var(--border); padding-top: 8px;">
            <div style="font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase;">Current Task</div>
            <div id="ctx-task" class="ctx-value" style="font-size: 0.85rem; margin-top: 2px;">—</div>
            <div id="ctx-task-priority" class="ctx-priority"></div>
          </div>

          <div id="ctx-preflight" class="preflight-check" style="margin-top: 8px;">
            <span class="preflight-status"></span>
            <span class="preflight-label">Alignment: Offline</span>
          </div>
          <div id="ctx-alignment-details" class="ctx-meta" style="margin-top: 4px; font-size: 10px;"></div>

          <div id="ctx-delegation-container" style="margin-top: 8px; border-top: 1px solid var(--border); padding-top: 8px;">
            <div style="font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px;">Delegation Chain</div>
            <div id="ctx-delegation" class="delegation-chain"></div>
          </div>
        </section>

        <section class="context-section">
          <div class="section-header-row">
            <h3>Requests Received</h3>
            <span id="count-requests" class="ctx-badge">0</span>
          </div>
          <ul id="ctx-requests-list" class="tracker-list">
            <li class="ctx-empty">Loading requests...</li>
          </ul>
        </section>

        <section class="context-section">
          <div class="section-header-row">
            <h3>Tasks To-Do</h3>
            <span id="count-todo" class="ctx-badge">0</span>
          </div>
          <ul id="ctx-tasks-todo" class="tracker-list">
            <li class="ctx-empty">Awaiting tasks...</li>
          </ul>
        </section>

        <section class="context-section">
          <div class="section-header-row">
            <h3>Completed Tasks</h3>
            <span id="count-completed" class="ctx-badge">0</span>
          </div>
          <ul id="ctx-tasks-completed" class="tracker-list">
            <li class="ctx-empty">No completions</li>
          </ul>
        </section>

        <section class="context-section">
          <div class="section-header-row">
            <h3>Sent Tasks (Delegation)</h3>
            <span id="count-sent" class="ctx-badge">0</span>
          </div>
          <ul id="ctx-tasks-sent" class="tracker-list">
            <li class="ctx-empty">No delegations</li>
          </ul>
        </section>

        <hr>
        <section class="context-section">
          <div class="ads-feed-header">
            <h3>Recent ADS Events</h3>
            <span id="ctx-ads-count" class="ctx-badge">0</span>
          </div>
          <ul id="ctx-ads-feed" class="ads-feed">
            <!-- ADS events injected by JS -->
          </ul>
        </section>
      </div>
    </aside>
  </div>

  <!-- Bottom Status Bar -->
  <footer id="statusbar">
    <span id="status-ads" class="status-item">
      <span class="status-dot dot-green"></span> ADS: 0 events
    </span>
    <span id="status-sessions" class="status-item">Sessions: 0</span>
    <span id="status-remote" class="status-item clickable" title="Go Remote (Secure Tunnel)">
      <span class="status-dot dot-grey"></span> <span class="remote-label">Go Remote</span>
    </span>
    <span id="status-escalations" class="status-item status-escalations">Escalations: 0</span>
    <span id="status-dttp" class="status-item">DTTP: --</span>
    <span id="status-clock"></span>
  </footer>

  <!-- Notification Toast Container -->
  <div id="toast-container" class="toast-container"></div>

  <!-- New Session Dialog -->
  <dialog id="new-session-dialog">
    <form id="new-session-form">
      <h2>New Session</h2>
      <label>
        Agent
        <select id="input-agent">
          <option value="claude" data-command="claude" data-color="#6B7FD7">Claude Code</option>
          <option value="gemini" data-command="gemini" data-color="#4CAF50">Gemini CLI</option>
          <option value="shell" data-command="/bin/bash" data-color="#8b949e">System Shell (Bash)</option>
          <option value="custom">Custom...</option>
        </select>
      </label>
      <label id="custom-command-group" style="display:none">
        Command
        <input type="text" id="input-custom-command" placeholder="/usr/bin/bash">
      </label>
      <label>
        Role
        <select id="input-role">
          <option value="Systems_Architect">Systems Architect</option>
          <option value="Backend_Engineer">Backend Engineer</option>
          <option value="Frontend_Engineer">Frontend Engineer</option>
          <option value="DevOps_Engineer">DevOps Engineer</option>
          <option value="Overseer">Overseer</option>
        </select>
      </label>
      <label>
        Active Spec
        <select id="input-spec">
          <!-- Populated by JS -->
          <option value="SPEC-017">SPEC-017: ADT Framework Repository</option>
        </select>
      </label>
      <label>
        Project
        <input type="text" id="input-project" value="/home/human/Projects/adt-framework" placeholder="Project root path">
      </label>
      <div class="dialog-actions">
        <button type="button" id="btn-cancel-session">Cancel</button>
        <button type="submit" class="primary">Launch</button>
      </div>
    </form>
  </dialog>

  <!-- Keyboard Shortcuts Overlay -->
  <div id="shortcuts-overlay" class="shortcuts-overlay" style="display:none">
    <div class="shortcuts-panel">
      <div class="shortcuts-header">
        <h2>Keyboard Shortcuts</h2>
        <button id="btn-close-shortcuts" class="shortcuts-close">&times;</button>
      </div>
      <div class="shortcuts-tabs"><button class="tab-btn active" data-tab="shortcuts">Shortcuts</button><button class="tab-btn" data-tab="settings">Settings</button></div><div id="shortcuts-tab-content" class="tab-content active"><div class="shortcuts-columns">
        <div class="shortcuts-group">
          <h3>Sessions</h3>
          <div class="shortcut-row"><kbd>Ctrl+N</kbd><span>New session</span></div>
          <div class="shortcut-row"><kbd>Ctrl+W</kbd><span>Close session</span></div>
          <div class="shortcut-row"><kbd>Ctrl+Tab</kbd><span>Next session</span></div>
          <div class="shortcut-row"><kbd>Shift+Ctrl+Tab</kbd><span>Previous session</span></div>
          <div class="shortcut-row"><kbd>Ctrl+1-5</kbd><span>Switch to slot</span></div>
        </div>
        <div class="shortcuts-group">
          <h3>Views</h3>
          <div class="shortcut-row"><kbd>Ctrl+D</kbd><span>Dashboard mode</span></div>
          <div class="shortcut-row"><kbd>Ctrl+G</kbd><span>Governance View</span></div>
          <div class="shortcut-row"><kbd>Ctrl+P</kbd><span>Full ADT Panel</span></div>
          <div class="shortcut-row"><kbd>Ctrl+\</kbd><span>Split view</span></div>
          <div class="shortcut-row"><kbd>Ctrl+B</kbd><span>Toggle sessions panel</span></div>
          <div class="shortcut-row"><kbd>Ctrl+I</kbd><span>Toggle context panel</span></div>
        </div>
        <div class="shortcuts-group">
          <h3>Global (Tauri only)</h3>
          <div class="shortcut-row"><kbd>Ctrl+Shift+A</kbd><span>Focus console</span></div>
          <div class="shortcut-row"><kbd>Ctrl+Shift+1-5</kbd><span>Jump to session</span></div>
          <div class="shortcut-row"><kbd>Ctrl+Shift+E</kbd><span>Focus ADS feed</span></div>
        </div>
      </div>
      </div>
      <div id="settings-tab-content" class="tab-content">
        <div class="settings-group">
          <h3>General</h3>
          <div class="setting-row">
            <span>Launch on startup</span>
            <label class="switch">
              <input type="checkbox" id="setting-autostart">
              <span class="slider"></span>
            </label>
          </div>
        </div>
        <div class="settings-group">
          <h3>Connections</h3>
          <div class="setting-row">
            <span>ADT Center URL</span>
            <input type="text" id="setting-center-url" placeholder="http://localhost:5001">
          </div>
          <div class="setting-row">
            <span>DTTP Service URL</span>
            <input type="text" id="setting-dttp-url" placeholder="http://localhost:5002">
          </div>
        </div>
        <div class="settings-group">
          <h3>Enforcement</h3>
          <div class="setting-row">
            <span>Production Mode</span>
            <span class="ctx-meta">Requires sudo-capable 'agent' user</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="vendor/xterm.min.js"></script>
  <script src="vendor/xterm-addon-fit.min.js"></script>
  <script src="js/terminal.js"></script>
  <script src="js/sessions.js"></script>
  <script src="js/dashboard.js"></script>
  <script src="js/context.js"></script>
  <script src="js/governance.js"></script>
  <script src="js/app.js"></script>
</body>
</html>